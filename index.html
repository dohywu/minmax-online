<!DOCTYPE html>
<html lang="ko">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>minMAX</title>
    <style>
      :root {
        --bg: #0b0b0b;
        --panel: #111213;
        --fg: #e9e9e9;
        --muted: #9aa0a6;
        --border: #222428;
        --btn: #161719;
        --btn-hover: #1b1d21;
        --shadow-1: rgba(0, 0, 0, 0.5);
        --shadow-2: rgba(0, 0, 0, 0.35);
        --glow: rgba(255, 255, 255, 0.06);
      }
      * {
        box-sizing: border-box;
      }
      html,
      body {
        height: 100%;
      }
      body {
        margin: 0;
        font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto,
          Noto Sans, 'Apple SD Gothic Neo', 'Malgun Gothic', sans-serif;
        color: var(--fg);
        background: var(--bg);
      }
      /* 스플래시 화면 */
      #splash {
        position: fixed;
        inset: 0;
        background: var(--bg);
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        z-index: 3000;
        opacity: 1; /* 기본 불투명 */
        transition: opacity 1s ease; /* 1초 동안 서서히 사라짐 */
      }

      #splash img {
        max-width: 200px;
        margin-bottom: 1rem;
      }
      #splash h1 {
        font-size: 1.5rem;
        color: var(--fg);
        font-weight: 500;
      }
      /* 본 컨텐츠 */

      button {
        appearance: none;
        border: 1px solid var(--border);
        background: var(--btn);
        color: var(--fg);
        padding: 0.5rem 0.75rem;
        border-radius: 0.75rem;
        cursor: pointer;
        font-size: 0.9rem;
        line-height: 1;
        box-shadow: 0 0 0 1px var(--glow) inset, 0 0.5px 0 var(--shadow-2);
      }
      button:hover {
        background: var(--btn-hover);
        box-shadow: 0 0 0 1px var(--glow) inset, 0 2px 12px var(--shadow-2);
      }
      button:disabled {
        opacity: 0.35;
        cursor: not-allowed;
      }
      .toolbar {
        position: sticky;
        top: 0;
        z-index: 2000;
        display: flex;
        align-items: center;
        gap: 0.5rem;
        padding: 0.75rem 0.9rem;
        background: color-mix(in oklab, var(--panel), transparent 10%);
        backdrop-filter: saturate(1.2) blur(6px);
        border-bottom: 1px solid var(--border);
      }
      .divider {
        width: 1px;
        height: 20px;
        background: var(--border);
        margin: 0 0.25rem;
      }
      .grow {
        flex: 1;
      }
      .counter {
        font-variant-numeric: tabular-nums;
        font-size: 0.9rem;
        color: var(--muted);
      }

      .stage {
        position: relative;
        height: calc(100vh - 56px);
        overflow: hidden;
      }
      .grain {
        position: absolute;
        inset: 0;
        pointer-events: none;
        background: radial-gradient(
            ellipse at center,
            transparent 60%,
            rgba(255, 255, 255, 0.03)
          ),
          radial-gradient(
            150% 100% at 0% 100%,
            rgba(255, 255, 255, 0.02),
            transparent 60%
          );
      }
      .stack-root {
        position: absolute;
        inset: 0;
        display: flex;
        align-items: center;
        justify-content: flex-start;
        padding: 0 24px;
      }
      .layer {
        position: absolute;
        left: 24px;
        top: 50%;
        transform: translateY(-50%);
        will-change: transform, opacity, filter;
        transition: transform 0.35s cubic-bezier(0.2, 0.6, 0.18, 1),
          opacity 0.35s ease, filter 0.35s ease;
      }
      .page {
        display: block;
        object-fit: contain;
        object-position: left center;
        user-select: none;
        -webkit-user-drag: none;
        background: none;
        /* 이미지 자체 그림자만 */
        /* box-shadow: 0 1px 0 var(--shadow-1), 0 8px 26px var(--shadow-2), 0 0 0 1px var(--glow) inset; */
      }

      .hint {
        position: absolute;
        right: 16px;
        bottom: 16px;
        font-size: 0.8rem;
        color: var(--muted);
        background: color-mix(in oklab, var(--panel), transparent 20%);
        backdrop-filter: blur(6px);
        border: 1px solid var(--border);
        padding: 4px 8px;
        border-radius: 8px;
      }
      .toggle {
        display: inline-flex;
        align-items: center;
        gap: 0.4rem;
        font-size: 0.9rem;
        color: var(--fg);
      }
      input[type='checkbox'] {
        width: 16px;
        height: 16px;
        accent-color: #d0d0d0;
        filter: drop-shadow(0 0 0.25px var(--glow));
      }
      .kbd {
        font-family: ui-monospace, SFMono-Regular, Menlo, monospace;
        background: var(--btn);
        color: var(--fg);
        border: 1px solid var(--border);
        padding: 2px 6px;
        border-radius: 6px;
        box-shadow: inset 0 -1px 0 var(--shadow-2);
      }
      @media (max-width: 640px) {
        .layer {
          left: 16px;
        }
        .stack-root {
          padding: 0 16px;
        }
      }
    </style>
  </head>
  <body>
    <!-- 스플래시 화면 -->
    <div id="splash">
      <img
        src="https://dohywu.github.io/minmax-online/src/image/1.png"
        alt="loading image"
      />
      <h1>Loading...</h1>
    </div>

    <!-- 본 컨텐츠 -->
    <header class="toolbar" role="toolbar" aria-label="Controls">
      <span id="counter" class="counter">0 / 0</span>
      <div class="divider" aria-hidden="true"></div>
      <button id="prevBtn" type="button" aria-label="Previous (←)">Prev</button>
      <button id="nextBtn" type="button" aria-label="Next (→/Space)">
        Next
      </button>
      <div class="divider" aria-hidden="true"></div>
      <label class="toggle" title="세로 맞춤(F)">
        <input id="fitHeightToggle" type="checkbox" checked />
        Fit to height
      </label>
      <button
        type="button"
        onclick="location.href='https://dohywu.github.io/index2.html'"
      >
        Graphic View
      </button>
      <div class="grow"></div>
    </header>

    <main id="stage" class="stage" aria-live="polite">
      <div class="grain" aria-hidden="true"></div>
      <div class="stack-root" id="stackRoot"></div>
      <div class="hint">
        ←/→ 또는 Space • <span class="kbd">F</span> = 맞춤 전환
      </div>
    </main>

    <script>
      // 스플래시 -> 메인 전환
      // 스플래시 → 메인 전환
      setTimeout(() => {
        const splash = document.getElementById('splash');
        splash.style.opacity = '0'; // 먼저 서서히 투명하게
        setTimeout(() => {
          splash.style.display = 'none'; // 애니메이션 끝난 후 완전히 제거
          document.querySelector('header').style.display = 'flex';
          document.querySelector('main').style.display = 'block';
        }, 1000); // transition 시간(1s)과 맞춤
      }, 5000); // 5초 후 실행

      // ---------------------------
      // State
      // ---------------------------
      const demo = [
        'https://dohywu.github.io/minmax-online/src/image/1.png',
        'https://dohywu.github.io/minmax-online/src/image/2.png',
        'https://dohywu.github.io/minmax-online/src/image/3.png',
        'https://dohywu.github.io/minmax-online/src/image/4-1.png',
        'https://dohywu.github.io/minmax-online/src/image/4-2.png',
        'https://dohywu.github.io/minmax-online/src/image/4-3.png',
        'https://dohywu.github.io/minmax-online/src/image/5.png',
        'https://dohywu.github.io/minmax-online/src/image/6-1.png',
        'https://dohywu.github.io/minmax-online/src/image/6-2.png',
        'https://dohywu.github.io/minmax-online/src/image/7.png',
        'https://dohywu.github.io/minmax-online/src/image/8.png',
        'https://dohywu.github.io/minmax-online/src/image/9.png',
        'https://dohywu.github.io/minmax-online/src/image/10.png',
        'https://dohywu.github.io/minmax-online/src/image/11.png',
        'https://dohywu.github.io/minmax-online/src/image/12.png',
        'https://dohywu.github.io/minmax-online/src/image/13.png',
        'https://dohywu.github.io/minmax-online/src/image/14.png',
        'https://dohywu.github.io/minmax-online/src/image/15.png',
        'https://dohywu.github.io/minmax-online/src/image/16.png',
        'https://dohywu.github.io/minmax-online/src/image/17.png',
        'https://dohywu.github.io/minmax-online/src/image/18.png',
        'https://dohywu.github.io/minmax-online/src/image/19.png',
        'https://dohywu.github.io/minmax-online/src/image/20.png',
        'https://dohywu.github.io/minmax-online/src/image/21.png',
        'https://dohywu.github.io/minmax-online/src/image/22.png',
        'https://dohywu.github.io/minmax-online/src/image/23.png',
        'https://dohywu.github.io/minmax-online/src/image/24.png',
        'https://dohywu.github.io/minmax-online/src/image/25.png',
        'https://dohywu.github.io/minmax-online/src/image/26.png',
        'https://dohywu.github.io/minmax-online/src/image/27.png',
        'https://dohywu.github.io/minmax-online/src/image/28.png',
        'https://dohywu.github.io/minmax-online/src/image/29.png',
      ];

      let pages = [...demo];
      let metas = [];
      let index = 0;
      let fitHeight = true;
      let scale = 1;

      const stackRoot = document.getElementById('stackRoot');
      const counter = document.getElementById('counter');
      const prevBtn = document.getElementById('prevBtn');
      const nextBtn = document.getElementById('nextBtn');
      const fitHeightToggle = document.getElementById('fitHeightToggle');
      const stage = document.getElementById('stage');

      function preload(src) {
        const img = new Image();
        img.src = src;
      }
      function updateCounter() {
        counter.textContent = `${pages.length ? index + 1 : 0} / ${
          pages.length
        }`;
      }
      function updateButtons() {
        prevBtn.disabled = index <= 0;
        nextBtn.disabled = index >= pages.length - 1;
      }

      function buildMetas(urls) {
        return Promise.all(
          urls.map(
            (src) =>
              new Promise((res) => {
                const img = new Image();
                img.onload = () =>
                  res({
                    w: img.naturalWidth || img.width,
                    h: img.naturalHeight || img.height,
                  });
                img.onerror = () => res({ w: 0, h: 0 });
                img.src = src;
              })
          )
        );
      }

      function computeUniformScale() {
        if (!metas.length) {
          scale = 1;
          return;
        }
        const maxW = Math.max(...metas.map((m) => m.w || 0));
        const maxH = Math.max(...metas.map((m) => m.h || 0));
        const vw = stage.clientWidth,
          vh = stage.clientHeight;
        const maxAllowedW = Math.floor(vw * 0.8);
        const maxAllowedH = Math.floor(vh * 0.8);
        if (fitHeight) {
          const s = maxH > 0 ? maxAllowedH / maxH : 1;
          scale = Math.min(s, 1);
        } else {
          const s = maxW > 0 ? maxAllowedW / maxW : 1;
          scale = Math.min(s, 1);
        }
      }

      function invalidateAndRender() {
        computeUniformScale();
        render();
      }

      function render() {
        stackRoot.innerHTML = '';
        updateCounter();
        updateButtons();
        if (!pages.length) return;
        for (let i = index; i < pages.length; i++) {
          const depth = i - index;
          const z = 1000 - i;
          const opacity = depth === 0 ? 1 : Math.max(0.18, 0.6 - depth * 0.12);
          const blurPx = Math.min(10, depth * 1.8);
          const grayPct = Math.min(60, depth * 10);
          const yOffset = depth * 2,
            xJitter = depth * 1;
          const layer = document.createElement('div');
          layer.className = 'layer';
          layer.style.zIndex = z;
          layer.style.transform = `translateY(calc(-50% + ${yOffset}px)) translateX(${xJitter}px)`;
          const img = document.createElement('img');
          img.className = 'page';
          img.alt = `page-${i + 1}`;
          img.src = pages[i];
          const meta = metas[i] || { w: 0, h: 0 };
          if (meta.w && meta.h) {
            img.style.width = Math.round(meta.w * scale) + 'px';
            img.style.height = Math.round(meta.h * scale) + 'px';
          } else {
            const vw = stage.clientWidth,
              vh = stage.clientHeight;
            img.style.maxWidth = Math.floor(vw * 0.8) + 'px';
            img.style.maxHeight = Math.floor(vh * 0.8) + 'px';
          }
          img.style.filter = `blur(${blurPx}px) grayscale(${grayPct}%)`;
          img.style.opacity = opacity;
          layer.appendChild(img);
          stackRoot.appendChild(layer);
        }
        for (let k = 1; k <= 3; k++)
          if (index + k < pages.length) preload(pages[index + k]);
      }

      prevBtn.addEventListener('click', () => {
        if (index > 0) {
          index--;
          render();
        }
      });
      nextBtn.addEventListener('click', () => {
        if (index < pages.length - 1) {
          index++;
          render();
        }
      });
      fitHeightToggle.addEventListener('change', (e) => {
        fitHeight = !!e.target.checked;
        invalidateAndRender();
      });
      window.addEventListener('keydown', (e) => {
        if (['INPUT', 'TEXTAREA'].includes(document.activeElement.tagName))
          return;
        if (e.key === 'ArrowRight' || e.key === ' ') {
          nextBtn.click();
          e.preventDefault();
        }
        if (e.key === 'ArrowLeft') {
          prevBtn.click();
          e.preventDefault();
        }
        if (e.key.toLowerCase() === 'f') {
          fitHeightToggle.checked = !fitHeightToggle.checked;
          fitHeight = fitHeightToggle.checked;
          invalidateAndRender();
        }
      });
      window.addEventListener('resize', () => invalidateAndRender());

      (pages.length ? buildMetas(pages) : Promise.resolve([])).then((m) => {
        metas = m;
        invalidateAndRender();
      });
    </script>
  </body>
</html>
